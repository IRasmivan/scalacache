<html><head><title>ScalaCache: Memoization</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Chris Birchall" /><meta name="description" content="A facade for the most popular cache implementations, with a simple, idiomatic Scala API." /><meta name="og:image" content="/scalacache/img/poster.png" /><meta name="og:title" content="ScalaCache: Memoization" /><meta name="og:site_name" content="ScalaCache" /><meta name="og:url" content="https://github.com/cb372/scalacache" /><meta name="og:type" content="website" /><meta name="og:description" content="A facade for the most popular cache implementations, with a simple, idiomatic Scala API." /><link rel="icon" type="image/png" href="/scalacache/img/favicon.png" /><meta name="twitter:title" content="ScalaCache: Memoization" /><meta name="twitter:image" content="https://github.com/cb372/scalacacheimg/poster.png" /><meta name="twitter:description" content="A facade for the most popular cache implementations, with a simple, idiomatic Scala API." /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@cbirchall" /><link rel="icon" type="image/png" sizes="16x16" href="/scalacache/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/scalacache/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/scalacache/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/scalacache/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/scalacache/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/scalacache/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/scalacache/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/scalacache/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/scalacache/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/scalacache/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/scalacache/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/scalacache/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/scalacache/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/scalacache/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/scalacache/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/scalacache/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/scalacache/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/scalacache/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/scalacache/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/scalacache/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/scalacache/highlight/styles/default.css" /><link rel="stylesheet" href="/scalacache/css/style.css" /><link rel="stylesheet" href="/scalacache/css/palette.css" /><link rel="stylesheet" href="/scalacache/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/scalacache/" class="brand"><div class="brand-wrapper"><span>ScalaCache</span></div></a></li> <li><a href="/scalacache/docs/index.html" class="">Getting started</a></li> <li><a href="/scalacache/docs/modes.html" class="">Modes</a></li> <li><a href="/scalacache/docs/sync-api.html" class="">Synchronous API</a></li> <li><a href="/scalacache/docs/memoization.html" class=" active ">Memoization</a></li> <li><a href="/scalacache/docs/flags.html" class="">Flags</a></li> <li><a href="/scalacache/docs/serialization.html" class="">Serialization</a></li> <li><a href="/scalacache/docs/cache-implementations.html" class="">Cache implementations</a></li> <li><a href="/scalacache/docs/restrictions.html" class="">Troubleshooting/Restrictions</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/cb372/scalacache"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/cb372/scalacache"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('ScalaCache A facade for the most popular cache implementations, with a simple, idiomatic Scala API.');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('ScalaCache A facade for the most popular cache implementations, with a simple, idiomatic Scala API.');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="cb372" data-github-repo="scalacache"><div class="content-wrapper"><section><h3 id="memoization-of-method-results">Memoization of method results</h3>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scalacache._</span>
<span class="k">import</span> <span class="nn">scalacache._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scalacache.memcached._</span>
<span class="k">import</span> <span class="nn">scalacache.memcached._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scalacache.memoization._</span>
<span class="k">import</span> <span class="nn">scalacache.memoization._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scalacache.serialization.binary._</span>
<span class="k">import</span> <span class="nn">scalacache.serialization.binary._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scalacache.modes.try_._</span>
<span class="k">import</span> <span class="nn">scalacache.modes.try_._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scala.util.Try</span>
<span class="k">import</span> <span class="nn">scala.util.Try</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Cat</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">colour</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="n">defined</span> <span class="k">class</span> <span class="nc">Cat</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">implicit</span> <span class="k">val</span> <span class="nv">catsCache</span><span class="k">:</span> <span class="kt">Cache</span><span class="o">[</span><span class="kt">Cat</span><span class="o">]</span> <span class="k">=</span> <span class="nc">MemcachedCache</span><span class="o">(</span><span class="s">"localhost:11211"</span><span class="o">)</span>
<span class="n">catsCache</span><span class="k">:</span> <span class="kt">scalacache.Cache</span><span class="o">[</span><span class="kt">Cat</span><span class="o">]</span> <span class="k">=</span> <span class="nv">scalacache</span><span class="o">.</span><span class="py">memcached</span><span class="o">.</span><span class="py">MemcachedCache</span><span class="k">@</span><span class="mi">4</span><span class="n">eb51b20</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="c1">// You wouldn't normally need to specify the type params for memoize.
</span>     <span class="o">|</span> <span class="c1">// This is an artifact of the way this README is generated using tut.
</span>     <span class="o">|</span> <span class="k">def</span> <span class="nf">getCat</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Cat</span><span class="o">]</span> <span class="k">=</span> <span class="n">memoize</span><span class="o">[</span><span class="kt">Try</span>, <span class="kt">Cat</span><span class="o">](</span><span class="nc">Some</span><span class="o">(</span><span class="mf">10.</span><span class="n">seconds</span><span class="o">))</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="c1">// Retrieve data from a remote API here ...
</span>     <span class="o">|</span>   <span class="nc">Cat</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">s</span><span class="s">"cat ${id}"</span><span class="o">,</span> <span class="s">"black"</span><span class="o">)</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="n">getCat</span><span class="k">:</span> <span class="o">(</span><span class="kt">id:</span> <span class="kt">Int</span><span class="o">)</span><span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">Cat</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nf">getCat</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span>
<span class="n">res2</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">Cat</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Cat</span><span class="o">(</span><span class="mi">123</span><span class="o">,</span><span class="n">cat</span> <span class="mi">123</span><span class="o">,</span><span class="n">black</span><span class="o">))</span>
</code></pre></div></div>

<p>Did you spot the magic word ‘memoize’ in the <code class="highlighter-rouge">getCat</code> method? Just adding this keyword will cause the result of the method to be memoized to a cache.
The next time you call the method with the same arguments the result will be retrieved from the cache and returned immediately.</p>

<p>If the result of your block is wrapped in an effect container, use <code class="highlighter-rouge">memoizeF</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">getCatF</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">Cat</span><span class="o">]</span> <span class="k">=</span> <span class="n">memoizeF</span><span class="o">[</span><span class="kt">Try</span>, <span class="kt">Cat</span><span class="o">](</span><span class="nc">Some</span><span class="o">(</span><span class="mf">10.</span><span class="n">seconds</span><span class="o">))</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="nc">Try</span> <span class="o">{</span>
     <span class="o">|</span>     <span class="c1">// Retrieve data from a remote API here ...
</span>     <span class="o">|</span>     <span class="nc">Cat</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">s</span><span class="s">"cat ${id}"</span><span class="o">,</span> <span class="s">"black"</span><span class="o">)</span>
     <span class="o">|</span>   <span class="o">}</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="n">getCatF</span><span class="k">:</span> <span class="o">(</span><span class="kt">id:</span> <span class="kt">Int</span><span class="o">)</span><span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">Cat</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nf">getCatF</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span>
<span class="n">res3</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">Cat</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Cat</span><span class="o">(</span><span class="mi">123</span><span class="o">,</span><span class="n">cat</span> <span class="mi">123</span><span class="o">,</span><span class="n">black</span><span class="o">))</span>
</code></pre></div></div>

<h4 id="synchronous-memoization-api">Synchronous memoization API</h4>

<p>Again, there is a synchronous memoization method for convient use of the synchronous mode:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scalacache.modes.sync._</span>
<span class="k">import</span> <span class="nn">scalacache.modes.sync._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">getCatSync</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Cat</span> <span class="o">=</span> <span class="nf">memoizeSync</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="mf">10.</span><span class="n">seconds</span><span class="o">))</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="c1">// Do DB lookup here ...
</span>     <span class="o">|</span>   <span class="nc">Cat</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">s</span><span class="s">"cat ${id}"</span><span class="o">,</span> <span class="s">"black"</span><span class="o">)</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="n">getCatSync</span><span class="k">:</span> <span class="o">(</span><span class="kt">id:</span> <span class="kt">Int</span><span class="o">)</span><span class="kt">Cat</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nf">getCatSync</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span>
<span class="n">res4</span><span class="k">:</span> <span class="kt">Cat</span> <span class="o">=</span> <span class="nc">Cat</span><span class="o">(</span><span class="mi">123</span><span class="o">,</span><span class="n">cat</span> <span class="mi">123</span><span class="o">,</span><span class="n">black</span><span class="o">)</span>
</code></pre></div></div>

<h4 id="how-it-works">How it works</h4>

<p><code class="highlighter-rouge">memoize</code> automatically builds a cache key based on the method being called, and the values of the arguments being passed to that method.</p>

<p>Under the hood it makes use of Scala macros, so most of the information needed to build the cache key is gathered at compile time. No reflection or AOP magic is required at runtime.</p>

<h4 id="cache-key-generation">Cache key generation</h4>

<p>The cache key is built automatically from the class name, the name of the enclosing method, and the values of all of the method’s parameters.</p>

<p>For example, given the following method:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">foo</span>

<span class="k">object</span> <span class="nc">Bar</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">baz</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">String</span><span class="o">)(</span><span class="n">c</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="nf">memoizeSync</span><span class="o">(</span><span class="nc">None</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Reticulating splines...   
</span>    <span class="mi">123</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>the result of the method call</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">Bar</span><span class="o">.</span><span class="py">baz</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"hello"</span><span class="o">)(</span><span class="s">"world"</span><span class="o">)</span>
</code></pre></div></div>

<p>would be cached with the key: <code class="highlighter-rouge">foo.bar.Baz(1, hello)(world)</code>.</p>

<p>Note that the cache key generation logic is customizable. Just provide your own implementation of <a href="https://github.com/cb372/scalacache/blob/master/modules/core/shared/src/main/scala/scalacache/memoization/MethodCallToStringConverter.scala">MethodCallToStringConverter</a></p>

<h4 id="enclosing-classs-constructor-arguments">Enclosing class’s constructor arguments</h4>

<p>If your memoized method is inside a class, rather than an object, then the method’s result might depend on values passed to that class’s constructor.</p>

<p>For example, if your code looks like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">foo</span>

<span class="k">class</span> <span class="nc">Bar</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">def</span> <span class="nf">baz</span><span class="o">(</span><span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="nf">memoizeSync</span><span class="o">(</span><span class="nc">None</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
  <span class="o">}</span>
  
<span class="o">}</span>
</code></pre></div></div>

<p>then you want the cache key to depend on the values of both <code class="highlighter-rouge">a</code> and <code class="highlighter-rouge">b</code>. In that case, you need to use a different implementation of <a href="https://github.com/cb372/scalacache/blob/master/modules/core/shared/src/main/scala/scalacache/memoization/MethodCallToStringConverter.scala">MethodCallToStringConverter</a>, like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">val</span> <span class="nv">cacheConfig</span> <span class="k">=</span> <span class="nc">CacheConfig</span><span class="o">(</span>
  <span class="n">memoization</span> <span class="k">=</span> <span class="nc">MemoizationConfig</span><span class="o">(</span><span class="nv">MethodCallToStringConverter</span><span class="o">.</span><span class="py">includeClassConstructorParams</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div></div>

<p>Doing this will ensure that both the constructor arguments and the method arguments are included in the cache key:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nc">Bar</span><span class="o">(</span><span class="mi">10</span><span class="o">).</span><span class="py">baz</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span> <span class="c1">// cached as "foo.Bar(10).baz(42)" -&gt; 52
</span><span class="k">new</span> <span class="nc">Bar</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="py">baz</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span> <span class="c1">// cached as "foo.Bar(20).baz(42)" -&gt; 62
</span></code></pre></div></div>

<h4 id="excluding-parameters-from-the-generated-cache-key">Excluding parameters from the generated cache key</h4>

<p>If there are any parameters (either method arguments or class constructor arguments) that you don’t want to include in the auto-generated cache key for memoization, you can exclude them using the <code class="highlighter-rouge">@cacheKeyExclude</code> annotation.</p>

<p>For example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">doSomething</span><span class="o">(</span><span class="n">userId</span><span class="k">:</span> <span class="kt">UserId</span><span class="o">)(</span><span class="k">implicit</span> <span class="nd">@cacheKeyExclude</span> <span class="n">db</span><span class="k">:</span> <span class="kt">DBConnection</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">memoize</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>will only include the <code class="highlighter-rouge">userId</code> argument’s value in its cache keys.</p>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/scalacache/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'cb372/scalacache'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/scalacache/js/main.js"></script></body></html>